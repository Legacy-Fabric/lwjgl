plugins {
    id 'java-library'
}

def ported = [
        "clean-generated",
        "clean-generated-native",
        "clean-java",
        "clean-native",
        "clean"
]

ant.importBuild('build.xml') { String oldTargetName ->
    if (ported.contains(oldTargetName)) return oldTargetName
    return "a-" + oldTargetName
}

// clean the generated files
tasks.register('clean-generated', Delete) {
    description = "Deletes the generated java source"
    delete ant.properties['lwjgl.src'] + "/generated"
}

tasks.register('clean-generated-native', Delete) {
    description = "Deletes the generated native source"
    dependsOn("clean-generated")
    delete ant.properties['lwjgl.src.native'] + "/generated"
}

// Cleans up any non-native files created during the execution of this script
tasks.register('clean-java', Delete) {
    description = "Cleans non-native files generated by this ant script"
    dependsOn("clean-generated")
    delete ant.properties['lwjgl.temp'], ant.properties['lwjgl.docs'] + "/javadoc", ant.properties['lwjgl.bin'] + "/org"
}

// Useful when we need to force native recompilation
tasks.register('clean-native', Delete) {
    description = "Cleans native files generated by this ant script"
    dependsOn("clean-generated-native")
    delete ant.properties['lwjgl.bin'] + "/lwjgles", ant.properties['lwjgl.bin'] + "/lwjgl"

    for (final def fl in file(ant.properties['lwjgl.src.native']).listFiles()) {
        if (fl.name.endsWith(".h")) {
            fl.delete()
        }
    }
}

tasks.clean.dependsOn("clean-java", "clean-native")

tasks["a-maven-full"].doFirst {
    clean-java
}